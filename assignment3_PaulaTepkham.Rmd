---
title: "Assignment3_PaulaTepkham"
author: "Phornchanok Tepkam"
date: "2025-02-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Thailand Trade dependency

Trade dependency play an important role of country's economic development and stability, since it is vulnerable to external shocks such as economic recessions in trading partners, volatile global commodty prices, and disruptions in supply chains, potentially leading to job losses, price fluctuations, and instability, if the country relies heavily on a narrow ranges of exports and import sources. Thailand is export-dependence country for a long time. In this analysis, I will deep dive into Thailand trade dependency compared to other countries. 

```{r install_packages}
# Install package and call library 'WDI' and Import data
if (!require("WDI")) install.packages("WDI")
if (!require("ggplot2")) install.packages("ggplot2")
if (!require("dplyr")) install.packages("dplyr")
if (!require("tidyverse")) install.packages("tidyverse")
if (!require("rnaturalearth")) install.packages("rnaturalearthdata")
if (!require("sf")) install.packages("sf") 

library(tidyverse)
library(plotly)
library(WDI)
library(ggplot2)
library(dplyr)
library(rnaturalearth) # World Map Data from Natural Earth 
library(sf) # Geographic Simple Features in R 
library(forcats) 
```
```{r import_wdi}
# import trade data
trade_data <- WDI(indicator=c("NY.GDP.PCAP.KD","NE.TRD.GNFS.ZS","NY.GDP.MKTP.KD","NE.EXP.GNFS.KD","NE.IMP.GNFS.KD"),extra=TRUE)

# chnage name into the easy name 
names(trade_data)[names(trade_data)=='NY.GDP.PCAP.KD'] <- 'gdp_percap'
names(trade_data)[names(trade_data)=='NE.TRD.GNFS.ZS'] <- 'trade_dep'
names(trade_data)[names(trade_data)=='NY.GDP.MKTP.KD'] <- 'gdp'
names(trade_data)[names(trade_data)=='NE.EXP.GNFS.KD'] <- 'export'
names(trade_data)[names(trade_data)=='NE.IMP.GNFS.KD'] <- 'import'

trade_data <- trade_data %>%
  mutate(net_trade_balance = export - import)  # Compute net trade balance

#check heading and summarize of the data
head(trade_data)
summary(trade_data)
```
```{r figure_1_1}


# Filter data for 2023 and compute the variables
trade_data_2023 <- trade_data %>%
  filter(year == 2023) %>%
  mutate(
    log_gdp_percap    = log(gdp_percap),
    net_trade_balance = log(abs(export - import)) * sign(export - import)
  )

# Create the interactive Plotly plot
fig <- plot_ly(
  data = trade_data_2023,
  x = ~log_gdp_percap,
  y = ~trade_dep,
  type = 'scatter',
  mode = 'markers+text',
  text = ~iso3c,
  textposition = 'top center',
  marker = list(
    opacity = 0.5,
    color = ~net_trade_balance,
    coloraxis = "coloraxis"
  )
) %>%
  layout(
    title = "Trade Dependency and GDP Per Capita, 2023",
    xaxis = list(title = "Log of GDP per Capita (2015 USD)"),
    yaxis = list(title = "Trade Dependency (% of GDP)"),
    coloraxis = list(
      colorscale = list(
        c(0, "darkorange"),  # High net imports (deficit)
        c(0.5, "black"),     # Balanced trade
        c(1, "darkblue")     # High net exports (surplus)
      ),
      colorbar = list(
        title = list(text = "Log of Net Export<br>(Exports - Imports)")
      )
    ),
    template = "plotly_white"
  )

fig
```

```{r figure_1_2}

trade_data_anim <- trade_data %>%
  filter(gdp_percap > 0, 
         !is.na(gdp_percap), 
         !is.na(trade_dep), 
         !is.na(export), 
         !is.na(import)) %>%
  mutate(
    log_gdp_percap    = log(gdp_percap),
    net_trade_balance = log(abs(export - import)) * sign(export - import)
  )

thailand_data <- trade_data_anim %>% filter(country == "Thailand")
others_data   <- trade_data_anim %>% filter(country != "Thailand")


custom_text <- ~paste(
  country,year,
  "<br>GDP per Capita (2015 USD): ", round(gdp_percap, 2),
  "<br>Trade Dependency (%): ", round(trade_dep, 2),
  "<br>Net Exports (Billions): ", round((export - import)/10000000, 2)
)

fig <- plot_ly() %>%
  add_trace(
    data = others_data,
    x = ~log_gdp_percap,
    y = ~trade_dep,
    frame = ~year,  
    text = custom_text,
    type = 'scatter',
    mode = 'markers',
    marker = list(size = 10, opacity = 0.8, color = "lightgray"),
    showlegend = FALSE
  ) %>%
  add_trace(
    data = thailand_data,
    x = ~log_gdp_percap,
    y = ~trade_dep,
    frame = ~year,
    type = 'scatter',
    mode = 'markers+text',
    text = custom_text, 
    textfont = list(      
      family = "Times",
      size = 14
    ),
    textposition = 'top center',
    marker = list(
      size = 12,
      opacity = 1,
      showscale = FALSE
    ),
    color = ~net_trade_balance,
    showlegend = FALSE
  ) %>%
  layout(
  title = list(
    text = "\nThailand Trade Dependency and GDP Per Capita, 1960-2023",
    x = 0.15,               
    xanchor = "left",
    font = list(
      family = "Times",
      fontface="bold",
      size = 18,
      color = "black"
    )
  ),
    xaxis = list(
      title = list(
        text = "Log of GDP per Capita (2015 USD)",
        font = list(
          family = "Times",
          size = 14,
          color = "black"
        )
      ),
      showgrid = FALSE   # Drop x-axis grid lines
    ),
    yaxis = list(
      title = list(
        text = "Trade Dependency (% of GDP)",
        font = list(
          family = "Times",
          size = 14,
          color = "black"
        )
      ),
      range = c(0, 500),
      showgrid = FALSE   # Drop y-axis grid lines
    ),
  coloraxis = list(
    colorscale = list(
      c(-20, "darkorange"),  
      c(0, "black"),     
      c(20, "darkblue")   
    ),
    colorbar = list(
      title = list(
        text = "Log of Net Export<br>(Exports - Imports)",
        font = list(
          family = "Times",
          size = 12,
          color = "black"
        )
      ),
      font = list(
        family = "Times",
        size = 12,
        color = "black"
      )
    )
  ),
  template = "plotly_white"
) %>%
  animation_opts(
    frame = 450,       
    transition = 0,
    redraw = TRUE
  ) %>%
  animation_slider(
    currentvalue = list(prefix = "Year: ")
  )

years <- sort(unique(thailand_data$year))
annotations_list <- list()

if (!is.null(fig$x$frames)) {
  for (i in seq_along(fig$x$frames)) {
    frame_year <- fig$x$frames[[i]]$name
    if (frame_year %in% names(annotations_list)) {
      fig$x$frames[[i]]$layout <- list(annotations = list(annotations_list[[frame_year]]))
    }
  }
}

fig
```

```{r figure_1_3}

df <- trade_data %>%
  filter(year %in% c(1960, 2023), !is.na(trade_dep), !is.na(income), income != "Aggregates")   %>%
  group_by(country) %>%
  filter(n() == 2) %>%  
  ungroup() %>%
  arrange(country, year) %>%
  mutate(
    paired = as.numeric(factor(country)),  
    year = factor(year),                   
    trade_dep = as.numeric(trade_dep),    
    income = factor(income, levels = c("High income", "Upper middle income", "Lower middle income", "Low income"))
  )
year_colors <- c("1960" = "lightblue", "2023" = "darkblue")

p <- ggplot(df, aes(x = trade_dep, y = fct_reorder(country, trade_dep, .na_rm = TRUE))) +
  geom_line(aes(group = paired), color = "lightblue") +  
  geom_point(aes(color = year), size = 2) +       
  scale_color_manual(name = "Year", values = year_colors) + 
  labs(
    x = "Trade Dependency (% of GDP)",
    y = "Country",
    title = "Trade Dependency Change by Income Group (1960 vs. 2023)"
  ) +
  theme_minimal() + 
  theme(text = element_text(size = 10)) +
  facet_wrap(~income, ncol = 1, scales = "free_y")  


ggplotly(p, height = 800)
```

```{r figure_1_4}
world <- ne_countries(scale = "medium", returnclass = "sf") %>%
  filter(admin != "Antarctica")

target_crs <- "+proj=moll"
world_moll <- st_transform(world, crs = target_crs)

world_trade <- world_moll %>%
  left_join(trade_data_2023, by = c("iso_a3" = "iso3c"))

world_trade_df <- world_trade %>%
  st_drop_geometry()  

trade_map <- plot_ly(
  data = world_trade_df,
  type = "choropleth",
  locations = ~iso_a3,
  z = ~trade_dep,
  text = ~paste(admin, "<br>Trade Dependency:", round(trade_dep, 2), "%"),
  colorscale = "Viridis",
  colorbar = list(title = "Trade Dependency (%)"),  # Add title to color bar
  marker = list(line = list(color = "black", width = 0.5))
) %>%
  layout(
    title = "Trade Dependency by Country (2023)",
    geo = list(
      projection = list(type = "mollweide"),
      showcoastlines = TRUE,
      coastlinecolor = "black"
    )
  )

trade_map

```


```{r figure_2_1}

thailand_trade <- trade_data %>%
  arrange(year) %>%
  filter(country == "Thailand", year >= 1960, year <= 2023) %>%
  select(year, export, import, gdp)  

fig <- plot_ly(data = thailand_trade) %>%
  add_lines(x = ~year, y = ~export, name = "Exports", line = list(color = "darkblue")) %>%
  add_lines(x = ~year, y = ~import, name = "Imports", line = list(color = "darkorange")) %>%
  # add_lines(x = ~year, y = ~gdp, name = "GDP", line = list(color = "grey")) %>%
  layout(
    title = "Thailand’s Export and Import (1960-2023)",
    xaxis = list(title = "Year"),
    yaxis = list(title = "Trade Value (in USD)"),
    legend = list(x = 0.1, y = 0.9),
    hovermode = "x unified"
  )

fig

```

```{r figure_2_2}
thailand_trade <- trade_data %>%
  filter(country == "Thailand", year >= 1960, year <= 2023) %>%
  select(year, export, import) %>%
  arrange(year) %>%
  mutate(
    net_export = export - import
  )

fig <- plot_ly(data = thailand_trade) %>%
  add_trace(
    x = ~year, y = ~import, name = "Imports", type = "scatter", mode = "none",
    fill = "tozeroy", fillcolor = "rgba(255, 140, 0, 0.5)"  
  ) %>%
  add_trace(
    x = ~year, y = ~export, name = "Exports", type = "scatter", mode = "none",
    fill = "tozeroy", fillcolor = "rgba(0, 0, 139, 0.5)" 
  ) %>%
  add_trace(
    x = ~year, y = ~net_export, name = "Net Exports", type = "scatter", mode = "lines",
    line = list(color = "black", width = 2, dash = "solid")  
  ) %>%
  layout(
    title = "Thailand’s Export, Import & Net Export (1960-2023)",
    xaxis = list(
      title = "Year",
      showgrid = FALSE  
    ),
    yaxis = list(
      title = "Trade Value (in USD)",
      zeroline = TRUE, zerolinecolor = "black",
      showgrid = FALSE  
    ),
    legend = list(x = 0.1, y = 0.9),
    hovermode = "x unified",

    shapes = list(
      list(
        type = "line",
        x0 = 1997, x1 = 1997,  
        y0 = min(thailand_trade$import), y1 = max(thailand_trade$export),  
        xref = "x", yref = "y",
        line = list(color = "black", width = 2, dash = "dot")  
      )
    ),

    annotations = list(
      list(
        x = 1997, y = max(thailand_trade$export) * 0.8,  
        text = "<b>Asian Financial Crisis 1997</b><br>Sharp decline in import",
        showarrow = TRUE,
        arrowhead = 3,  
        arrowsize = 1,
        ax = 50, ay = -40,  # Arrow position
        bgcolor = "rgba(255, 255, 255, 1)",  
        bordercolor = "black",  # Box border
        font = list(size = 12, color = "black")
      )
    )
  )

fig

```

```{r figure_2_3}

thailand_trade <- thailand_trade %>%
  arrange(year) %>%
  mutate(
    export_growth = (export / lag(export) - 1) * 100,  
    import_growth = (import / lag(import) - 1) * 100   
  ) %>%
  filter(!is.na(export_growth) & !is.na(import_growth))  


fig <- plot_ly(data = thailand_trade) %>%
  add_lines(x = ~year, y = ~export_growth, name = "Export Growth (%)", line = list(color = "darkblue")) %>%
  add_lines(x = ~year, y = ~import_growth, name = "Import Growth (%)", line = list(color = "darkorange")) %>%
  layout(
    title = "Thailand’s Export and Import Growth Rate (1960-2023)",
    xaxis = list(title = "Year"),
    yaxis = list(title = "Growth Rate (%)"),
    legend = list(x = 0.1, y = 0.9),
    hovermode = "x unified"
  )

fig
```



